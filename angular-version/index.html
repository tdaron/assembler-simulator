<!DOCTYPE html>
<html ng-app="ASMSimulator">
  <head>
    <title>Simple 16-bit Assembler Simulator in Javascript</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="assets/style.css" />
    <script type="text/javascript" src="//use.typekit.net/tor0zlh.js"></script>
    <script type="text/javascript">
      try {
        Typekit.load();
      } catch (e) {}
    </script>
  </head>

  <body ng-controller="Ctrl">

    <nav
      class="navbar navbar-inverse"
      role="navigation"
      style="background-color: #428bca; border: 0px; border-radius: 0px"
    >
      <div class="navbar">
        <div class="navbar-header navbar-right">
          <a class="navbar-brand" style="color: #ffffff">
            Simple 16-bit Assembler Simulator
          </a>
          <a
                  type="button"
                  class="btn btn-default navbar-btn"
                  href="instruction-set.html"
          >Instruction set</a
          >
        </div>

        <div class="actions">
          <div class="btn-group">
            <button
              type="button"
              class="btn btn-success navbar-btn"
              ng-click="run()"
              ng-hide="isRunning"
            >
              <span class="glyphicon glyphicon-play"></span> Run
            </button>
            <button
              type="button"
              class="btn btn-success navbar-btn"
              ng-click="runQuickly()"
              ng-hide="isRunning"
            >
              <span class="glyphicon glyphicon-play"></span> Run Quickly
            </button>
            <button
              type="button"
              class="btn btn-default navbar-btn"
              ng-click="stop()"
              ng-show="isRunning"
            >
              <span class="glyphicon glyphicon-stop"></span> Stop
            </button>
            <button
              type="button"
              class="btn btn-default navbar-btn"
              ng-click="executeStep()"
              ng-disabled="isRunning"
            >
              <span class="glyphicon glyphicon-forward"></span> Step
            </button>
            <button
                    type="button"
                    class="btn btn-default navbar-btn"
                    ng-click="reset()"
            >
              Reset
            </button>
            <button
                    type="button"
                    class="btn btn-default navbar-btn"
                    ng-click="downloadCode()"
            >
              Download Code
            </button>
          </div>

          <form method="post" enctype="multipart/form-data">
            <div>
              <label for="file">Choose file to load</label>
              <input type="file" id="file" name="file" />
            </div>
            <div>
              <button
                type="button"
                class="btn btn-default navbar-btn"
                ng-click="loadFile()"
              >
                Load file
              </button>
            </div>
          </form>
        </div>
      </div>
    </nav>
    <div>
      <div class="alert alert-danger" ng-hide="error === ''">{{ error }}</div>
      <div class="row main">
        <div class="editor-container">
          <div class=" ">
            <div class="">
              <h4 class="">
                Code
                <small
                  >(<a
                    href="./instruction-set.html"
                    target="_blank"
                    style="color: #337ab7"
                    >Instruction Set</a
                  >)</small
                >
              </h4>
            </div>
            <div>
              <div class="editor" id="editor" contenteditable="true" spellcheck="false"
                   select-line
                   ng-blur="updateCode($event)"
                   ng-keyup="updateCode($event)">

              </div>
              <button
                      type="button"
                      class="btn btn-default"
                      ng-click="assemble()"
              >
                Assemble
              </button>

            </div>
          </div>
        </div>
        <div class="col1">
          <div class=" ">
            <div class="">
              <h4 class="">Labels</h4>
            </div>
            <div class=" source-code">
              <table class="labels-table">
                <tr>
                  <th>Name</th>
                  <th>Address</th>
                  <th>Value</th>
                </tr>
                <tr ng-repeat="(name, value) in labels" class="codelabel">
                  <td class="codelabel-name">{{ name }}</td>
                  <td class="codelabel-line">
                    <a ng-click="jumpToLine(value)"  ng-mouseenter="setHighlight(value)"   ng-mouseleave="setHighlight(-1)">
                      {{ value| number:displayHex:true }}
                    </a>
                  </td>
                  <td class="codelabel-value">
                    {{ memory.load16(value) | number:displayHex:true }}
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class=" ">
              <button
                type="button"
                class="btn btn-default navbar-btn"
                ng-click="changeRamDisplayMode()"
              >
                Change RAM display mode (HEX/ASCII)
              </button>
            <h4 class="">Memory (RAM)</h4>
            <p style="margin-top: 5px">
              <small>
                <span style="margin-left: 5px">Instructions:</span>
                <a ng-click="displayInstr = true" ng-hide="displayInstr"
                >Show</a
                >
                <a ng-click="displayInstr = false" ng-show="displayInstr"
                >Hide</a
                >
              </small>
            </p>
              <div class="source-code">
                <div
                  class="memory-block"
                  ng-repeat="m in memory.data track by $index"
                  ng-class="getMemoryCellCss($index)"
                >
                  <div
                    ng-class="getMemoryInnerCellCss($index)"
                    ng-switch="isInstruction($index)"
                  >
                    <small ng-switch-default ng-show="ramDisplayMode === 'HEX'"
                      >{{ m | number:displayHex }}</small
                    >
                    <small
                      ng-switch-default
                      ng-show="ramDisplayMode === 'ASCII'"
                      >{{ getChar(m) }}</small
                    >
                    <a ng-switch-when="true" ng-click="jumpToLine($index)">
                      <small ng-show="ramDisplayMode === 'HEX'"
                        >{{ m | number:displayHex }}</small
                      >
                      <small ng-show="ramDisplayMode === 'ASCII'"
                        >{{ getChar(m) }}</small
                      >
                    </a>
                  </div>
                </div>
              </div>

            </div>
          </div>
        <div class="col2">
          <p>Registers / Flags</p>
          <table>
            <thead>
            <tr>
              <th style="text-align: center">A</th>
              <th style="text-align: center">B</th>
              <th style="text-align: center">C</th>
              <th style="text-align: center">D</th>
              <th style="text-align: center">PC</th>
              <th style="text-align: center">SP</th>
              <th style="text-align: center">DP</th>
              <th style="text-align: center">Z</th>
              <th style="text-align: center">C</th>
              <th style="text-align: center">F</th>
            </tr>
            </thead>
            <tbody>
            <tr style="text-align: center" class="source-code">
              <td>
                <div
                        style="margin: auto"
                        ng-class="{'marker': true, 'marker-a': displayA}"
                        ng-click="displayA = !displayA"
                >
                  <small>{{ cpu.gpr[0] | number:displayHex }}</small>
                </div>
              </td>
              <td>
                <div
                        style="margin: auto"
                        ng-class="{'marker': true, 'marker-b': displayB}"
                        ng-click="displayB = !displayB"
                >
                  <small>{{ cpu.gpr[1] | number:displayHex }}</small>
                </div>
              </td>
              <td>
                <div
                        style="margin: auto"
                        ng-class="{'marker': true, 'marker-c': displayC}"
                        ng-click="displayC = !displayC"
                >
                  <small>{{ cpu.gpr[2] | number:displayHex }}</small>
                </div>
              </td>
              <td>
                <div
                        style="margin: auto"
                        ng-class="{'marker': true, 'marker-d': displayD}"
                        ng-click="displayD = !displayD"
                >
                  <small>{{ cpu.gpr[3] | number:displayHex }}</small>
                </div>
              </td>
              <td>
                <div style="margin: auto" class="marker marker-ip">
                  <small>{{ cpu.ip | number:displayHex }}</small>
                </div>
              </td>
              <td>
                <div style="margin: auto" class="marker marker-sp">
                  <small>{{ cpu.sp | number:displayHex }}</small>
                </div>
              </td>
              <td>
                <div style="margin: auto" class="marker marker-dp">
                  <small>{{ cpu.dp | number:displayHex }}</small>
                </div>
              </td>
              <td><small>{{ cpu.zero | flag }}</small></td>
              <td><small>{{ cpu.carry | flag }}</small></td>
              <td><small>{{ cpu.fault | flag }}</small></td>
            </tr>
            </tbody>
          </table>

          <p>Clock Speed</p>
          <div class="clock-speed">
            <button
                    ng-repeat="item in speeds"
                    ng-click="setSpeed(item.speed)"
                    ng-class="{'active': speed === item.speed}"> {{ item.desc }}
            </button>

          </div>

          <p>Numbers Representation</p>
          <div class="clock-speed">
            <button
                    ng-click="displayHex = false"
                    ng-class="{'active': !displayHex}"> Decimal
            </button>
            <button
                    ng-click="displayHex = true"
                    ng-class="{'active': displayHex}"> Hexadecimal
            </button>

          </div>

          <h4>Screen Display</h4>
          <div class="screen-container">
            <div class="screen" >
              <table class="screen-table">
                <tbody>
                <tr ng-repeat="row in screenPixels track by $index">
                  <td ng-repeat="pixel in row track by $index">
                    <div
                      class="screen-pixel"
                      ng-class="{
                        'screen-pixel-on': pixel === 1,
                        'screen-pixel-off': pixel === 0
                      }"
                    ></div>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.10/angular.min.js"></script>
    <script src="assets/asmsimulator.js"></script>

  </body>
</html>
